{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<script defer src="{{ url_for('static', filename='script.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<header>
  <div class="header-wrapper">
    <div class="header-title">
        <h1>Dashboard</h1>
    </div>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Search..." onkeyup="filterTable()">
    </div>
  </div>
</header>

<table class="table" id="bookingTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Company</th>
      <th>Booking Id</th>
      <th>Booking Date</th>
      <th>Delivery Date</th>
      <th>Delivery Address</th>
      <th>Pincode</th>
      <th>Amount</th>
      <th>Status</th>
    </tr>
  </thead>
<tbody>
  {% for b in bookings %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ b.company }}</td>
      <td>{{ b.booking_id }}</td>
      <td>{{ b.booking_date.strftime('%d-%m-%Y') if b.booking_date else '-' }}</td>
      <td>
        {% if b.delivery_date %}
          {{ b.delivery_date.strftime('%d-%m-%Y') }}
        {% else %}
          {{ (b.booking_date + timedelta(days=2)).strftime('%d-%m-%Y') if b.booking_date else '-' }}
        {% endif %}
      </td>
      <td>{{ b.delivery_address or '-' }}</td>
      <td>{{ b.pincode or '-' }}</td>
      <td>{{ b.amount or 0 }}</td>
      <td>
        {{ b.status or 'Pending' }}
        {% if b.status == 'Pending' %}
          <a href="{{ url_for('payment', booking_id=b.id) }}" class="btn small">Repay</a>
        {% endif %}
      </td>
    </tr>
  {% else %}
    <tr><td colspan="8" id="nobooking">No bookings yet</td></tr>
  {% endfor %}
</tbody>
</table>

<script>
function filterTable() {
    let input = document.getElementById("searchInput");
    let filter = input.value.toLowerCase();
    let table = document.getElementById("bookingTable");
    let tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) { // Skip header row
        let tds = tr[i].getElementsByTagName("td");
        let match = false;

        for (let j = 1; j < tds.length; j++) { // Skip index column
            if (tds[j] && tds[j].textContent.toLowerCase().indexOf(filter) > -1) {
                match = true;
                break;
            }
        }

        tr[i].style.display = match ? "" : "none";
    }
}
</script>

<style>
.search-container {
    margin-bottom: 15px;
    text-align: right;
}
#searchInput {
    padding: 8px;
    width: 250px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
</style>

{% endblock %}
